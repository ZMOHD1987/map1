<!DOCTYPE html>
<html lang='ar' dir='rtl'>
<head>
    <meta charset='utf-8'>
    <title>Sharjah Municipality Food Control Section Map</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='stylesheet' href='https://unpkg.com/leaflet@1.7.1/dist/leaflet.css' />
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css' />
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        #map { height: 100vh; width: 100%; }
        #controls, #info { position: absolute; z-index: 400; background-color: rgba(255, 255, 255, 0.8); border-radius: 5px; padding: 10px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.1); font-size: 14px; }
        #controls { top: 10px; left: 10px; width: 200px; }
        #info { top: 10px; right: 10px; width: 200px; }
        h3 { color: #388e3c; font-size: 16px; margin: 0 0 5px 0; }
        label { display: block; margin-bottom: 5px; }
        input[type='checkbox'] { margin-right: 5px; }
        input[type='text'] { width: 100%; padding: 5px; margin-bottom: 10px; border-radius: 3px; border: 1px solid #ccc; }
        button { background-color: #388e3c; color: white; border: none; padding: 7px; border-radius: 3px; cursor: pointer; font-size: 14px; margin-bottom: 5px; }
        button i { margin-right: 5px; }
        button:hover { background-color: #2e7d32; }
        .custom-popup { font-size: 14px; }
        .hidden { display: none; }
        @media (max-width: 768px) {
            #controls, #info { width: 150px; font-size: 12px; }
            button { font-size: 12px; padding: 5px; }
            #map { height: calc(100vh - 50px); }
        }
        @media (max-width: 480px) {
            #controls, #info { width: 120px; font-size: 10px; }
            button { font-size: 10px; padding: 4px; }
            #map { height: calc(100vh - 70px); }
        }
    </style>
    <script src='https://unpkg.com/leaflet@1.7.1/dist/leaflet.js'></script>
    <script src='https://code.jquery.com/jquery-3.6.0.min.js'></script>
</head>
<body>
    <div id='map'></div>
    <div id='controls'>
        <input type='text' id='search-lic' placeholder='Searsh'>
        <button onclick="toggleVisibility('action-filters')"><i class='fas fa-filter'></i> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</button>
        <div id='action-filters' class='hidden'>
            <label><input type='checkbox' class='action-filter' value='Ø§Ù†Ø°Ø§Ø±'> Ø§Ù†Ø°Ø§Ø±</label>
            <label><input type='checkbox' class='action-filter' value='Ù…Ø®Ø§Ù„ÙØ©'> Ù…Ø®Ø§Ù„ÙØ©</label>
            <label><input type='checkbox' class='action-filter' value='Ø¹ÙŠÙ†Ø§Øª'> Ø¹ÙŠÙ†Ø§Øª</label>
            <label><input type='checkbox' class='action-filter' value='Ù…ØªØ§Ø¨Ø¹Ø©'> Ù…ØªØ§Ø¨Ø¹Ø©</label>
            <label><input type='checkbox' class='action-filter' value='Ù…ØºÙ„Ù‚'> Ù…ØºÙ„Ù‚</label>
            <label><input type='checkbox' class='action-filter' value='ØªÙ‚Ø±ÙŠØ±'> ØªÙ‚Ø±ÙŠØ±</label>
            <label><input type='checkbox' class='action-filter' value='Ù…Ù†Ø§Ø³Ø¨'> Ù…Ù†Ø§Ø³Ø¨</label>
        </div>
        <button onclick="toggleVisibility('sector-filters')"><i class='fas fa-layer-group'></i> Ø§Ù„Ù‚Ø·Ø§Ø¹</button>
        <div id='sector-filters' class='hidden'>
            <label><input type='checkbox' class='sector-filter' value='1'> Ø§Ù„Ù‚Ø·Ø§Ø¹ 1</label>
            <label><input type='checkbox' class='sector-filter' value='2'> Ø§Ù„Ù‚Ø·Ø§Ø¹ 2</label>
            <label><input type='checkbox' class='sector-filter' value='3'> Ø§Ù„Ù‚Ø·Ø§Ø¹ 3</label>
            <label><input type='checkbox' class='sector-filter' value='4'> Ø§Ù„Ù‚Ø·Ø§Ø¹ 4</label>
            <label><input type='checkbox' class='sector-filter' value='5'> Ø§Ù„Ù‚Ø·Ø§Ø¹ 5</label>
            <label><input type='checkbox' class='sector-filter' value='6'> Ø§Ù„Ù‚Ø·Ø§Ø¹ 6</label>
            <label><input type='checkbox' class='sector-filter' value='7'> Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© 7</label>
            <label><input type='checkbox' class='sector-filter' value='8'> Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© 8</label>
            <label><input type='checkbox' class='sector-filter' value='9'> Ø±Ø®ØµØ© Ø§Ø¹ØªÙ…Ø§Ø¯ 9</label>
            <label><input type='checkbox' class='sector-filter' value='10'> Ø§Ù„Ù…Ù‚Ø§ØµÙ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© 10</label>
            <label><input type='checkbox' class='sector-filter' value='11'> Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ 11</label>
        </div>
        <button onclick='filterPoints()'><i class='fas fa-check'></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±</button>
        <hr>
        <label>Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
        <input type='date' id='date-from'>
        <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
        <input type='date' id='date-to'>
        <div id='totals'></div>
    </div>
    <div id='info'>
        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ù‚Ø·Ø©</h3>
        <div><strong>Ø§Ù„Ø§Ø³Ù…: </strong><span id='info-name'></span></div>
        <div><strong>Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©: </strong><span id='info-BrandName'></span></div>
        <div><strong>Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©: </strong><span id='info-lic'></span></div>
        <div><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: </strong><span id='info-area'></span></div>
        <div><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©Ø§Ù„ÙØ±Ø¹ÙŠØ©: </strong><span id='info-subarea'></span></div>
        <div><strong>Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ: </strong><span id='info-sector'></span></div>
        <div><strong>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ: </strong><span id='info-AREA2'></span></div>
        <div><strong>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©: </strong><span id='info-subunit'></span></div>
        <div><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø´Ø£Ø©: </strong><span id='info-FacilityStatus'></span></div>
        <div><strong>ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: </strong><span id='info-Fdate'></span></div>
        <div><strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: </strong><span id='info-action'></span></div>
        <div><strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: </strong><span id='info-coordinates'></span></div>

    <!-- Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± WhatsApp ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø© -->
    <button onclick="sendWhatsApp()" style="background:none; border:none; cursor:pointer;">
        <i class="fab fa-whatsapp fa-2x" style="color: #25D366;"></i>
    </button>
    
    <!-- Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø© -->
    <button onclick="sendEmail()" style="background:none; border:none; cursor:pointer;">
        <i class="fas fa-envelope fa-2x" style="color: #0072C6;"></i>

 
</div>
<script>
// Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
function sendWhatsApp() {
    const name = document.getElementById('info-name').textContent;
    const brandName = document.getElementById('info-BrandName').textContent;
    const lic = document.getElementById('info-lic').textContent;
    const area = document.getElementById('info-area').textContent;
   const subarea = document.getElementById('info-subarea').textContent;
    const sector = document.getElementById('info-sector').textContent;
    const AREA2 = document.getElementById('info-AREA2').textContent;
    const status = document.getElementById('info-FacilityStatus').textContent;
    const Fdate= document.getElementById('info-Fdate').textContent;
    const action = document.getElementById('info-action').textContent;



    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³Ø§ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    let coordinates = document.getElementById('info-coordinates').textContent.trim();
    coordinates = coordinates.replace(/\s*,\s*/g, ","); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø­ÙˆÙ„ Ø§Ù„ÙØ§ØµÙ„Ø©

    // Ø±Ø§Ø¨Ø· Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„
    const googleMapsLink = `https://www.google.com/maps?q=${coordinates}`;

    // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
    const message = `Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ù‚Ø·Ø©:
Ø§Ù„Ø§Ø³Ù…: ${name}
Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©: ${brandName}
Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©: ${lic}
Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${area}
Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©: ${subarea}
Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ: ${sector}
Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ: ${AREA2}
Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø´Ø£Ø©: ${status}
ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${Fdate}
Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: ${action}
Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${coordinates}
Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„: ${googleMapsLink}`;

    // ÙØªØ­ Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨
    const whatsappURL = `https://wa.me/?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, '_blank');
}

// Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
function sendEmail() {
    const name = document.getElementById('info-name').textContent;
    const brandName = document.getElementById('info-BrandName').textContent;
    const lic = document.getElementById('info-lic').textContent;
    const area = document.getElementById('info-area').textContent;
    const subarea = document.getElementById('info-subarea').textContent;
    const sector = document.getElementById('info-sector').textContent;
    const AREA2 = document.getElementById('info-AREA2').textContent;
    const status = document.getElementById('info-FacilityStatus').textContent;
    const action = document.getElementById('info-action').textContent;
    const Fdate = document.getElementById('info-Fdate').textContent;


    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³Ø§ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    let coordinates = document.getElementById('info-coordinates').textContent.trim();
    coordinates = coordinates.replace(/\s*,\s*/g, ","); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø­ÙˆÙ„ Ø§Ù„ÙØ§ØµÙ„Ø©

    // Ø±Ø§Ø¨Ø· Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„
    const googleMapsLink = `https://www.google.com/maps?q=${coordinates}`;

    // Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    const subject = "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ù‚Ø·Ø©";

    // Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    const body = `Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ù‚Ø·Ø©:
Ø§Ù„Ø§Ø³Ù…: ${name}
Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©: ${brandName}
Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©: ${lic}
Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${area}
Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©: ${subarea}
Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ: ${sector}
Ø§Ù„ÙˆØµÙ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ: ${AREA2}
Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø´Ø£Ø©: ${status}
ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${Fdate}
Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: ${action}
Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${coordinates}
Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„: ${googleMapsLink}`;

    // ÙØªØ­ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    const mailtoURL = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.open(mailtoURL, '_blank');
}
</script>

    <script>
        function toggleVisibility(id) {
            var element = document.getElementById(id);
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
            } else {
                element.classList.add('hidden');
            }
        }
        var map = L.map('map').setView([25.276987, 55.296249], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        var allPointsLayer = L.layerGroup().addTo(map);
        var pointsData = [];
        pointsData.push({latitude: 25.434907, longitude: 55.583596, AREA2: '', sector: 8, color: 'cyan', lightColor: 'lightcyan', sectorColor: 'indigo', fname: 'ÙƒØ±Ø§ÙƒØ± & Ø¨Ø§ÙƒØ± Ø´ Ù… Ø­', area: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø±Ø© Ø¨Ø§Ù„Ø­Ù…Ø±ÙŠØ©', subarea: '', BrandName: '', FacilityStatus: 'Ù†Ø´Ø·', lic: '16198', subunit: 'Ù…ØµØ§Ù†Ø¹ Ø§Ù„Ø§ØºØ°ÙŠØ©', Fdate: '03/04/2025', action: 'Ø§Ù†Ø°Ø§Ø±'});
        pointsData.push({latitude: 25.370217213581185, longitude: 55.40521375825051, AREA2: 'Ù…Ø­Ù„ Ø±Ù‚Ù… 3', sector: 2, color: 'cyan', lightColor: 'lightcyan', sectorColor: 'darkorange', fname: 'Ø§Ù„Ù†Ø¬Ø§Ø± Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ Ø§Ù„Ù…Ù…Ù„Ø­Ø© Ø´ Ø° Ù… Ù… - ÙØ±Ø¹ Ø§Ù„Ø´Ø§Ø±Ù‚Ø©', area: 'Ø¨ÙˆØ¯Ø§Ù†Ù‚', subarea: '', BrandName: '', FacilityStatus: 'ØªØ¹Ù‡Ø¯ Ø¹Ø¯Ù… Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ù†Ø´Ø§Ø·', lic: '767553', subunit: '', Fdate: '', action: 'Ø§Ù†Ø°Ø§Ø±'});
        pointsData.push({latitude: 25.347119429556994, longitude: 55.40348992938506, AREA2: 'Ù…Ø­Ù„ Ø±Ù‚Ù… 5 + 6', sector: 2, color: 'cyan', lightColor: 'lightcyan', sectorColor: 'darkorange', fname: 'ÙƒØ§ÙØªÙŠØ±ÙŠØ§ Ø¹ÙŠÙˆÙ† Ø§Ù„Ø³Ù„Ø³Ø¨ÙŠÙ„', area: 'Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ', subarea: '', BrandName: '', FacilityStatus: 'ØªØ¹Ù‡Ø¯ Ø¹Ø¯Ù… Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ù†Ø´Ø§Ø·', lic: '773052', subunit: '', Fdate: '', action: 'Ø§Ù†Ø°Ø§Ø±'});
        pointsData.push({latitude: 25.30548681794288, longitude: 55.36773492939049, AREA2: '', sector: 1, color: 'cyan', lightColor: 'lightcyan', sectorColor: 'darkblue', fname: 'Ø¨Ù‚Ø§Ù„Ø© Ø§Ù„Ù…ÙŠØ§Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡', area: 'Ø§Ù„Ù…Ù…Ø²Ø±', subarea: '', BrandName: '', FacilityStatus: 'ØªØ¹Ù‡Ø¯ Ø¹Ø¯Ù… Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ù†Ø´Ø§Ø·', lic: '779585', subunit: '', Fdate: '', action: 'Ù…Ø®Ø§Ù„ÙØ©'});
        pointsData.push({latitude: 25.312743998054305, longitude: 55.47685571404563, AREA2: '', sector: 5, color: 'cyan', lightColor: 'lightcyan', sectorColor: 'saddlebrown', fname: 'Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª Ø§ÙˆÙˆÙ„ Ø¯ÙŠ Ù…Ø§Ø±ÙƒØª Ø´ Ø° Ù… Ù… ÙØ±Ø¹ 1', area: 'Ø§Ù„Ø¬Ø§Ø¯Ø©', subarea: '', BrandName: '', FacilityStatus: 'ØªØ¹Ù‡Ø¯ Ø¹Ø¯Ù… Ù…Ù…Ø§Ø±Ø³Ø© Ø§Ù„Ù†Ø´Ø§Ø·', lic: '906053', subunit: '', Fdate: '', action: 'Ø§Ù†Ø°Ø§Ø±'});
        pointsData.push({latitude: 25.307753209173377, longitude: 55.45870510280212, AREA2: '', sector: 2, color: 'cyan', lightColor: 'lightcyan', sectorColor: 'darkorange', fname: 'Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª Ø­Ø³Ù†Ø© Ù…Ø­Ù…Ø¯ Ø° Ù… Ù… Ø´ Ø´ Ùˆ', area: 'ØªØ¬Ø§Ø±ÙŠØ© Ù…ÙˆÙŠÙ„Ø­', subarea: '', BrandName: '', FacilityStatus: 'Ù†Ø´Ø·', lic: '914178', subunit: '', Fdate: '', action: 'Ø§Ù†Ø°Ø§Ø±'});
        pointsData.push({latitude: 25.294272555416065, longitude: 55.47808821349145, AREA2: '', sector: 7, color: 'cyan', lightColor: 'lightcyan', sectorColor: 'firebrick', fname: 'Ø¬Ø§ÙŠÙ… Ø§ÙŠØ³ ÙƒØ±ÙŠÙ…', area: 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©', subarea: '', BrandName: '', FacilityStatus: 'Ù†Ø´Ø·', lic: '1122167', subunit: '', Fdate: '', action: 'Ø§Ù†Ø°Ø§Ø±'});

        function renderPoints(points) {
            allPointsLayer.clearLayers();
            points.forEach(function(point) {
                var pointMarker = L.circleMarker([point.latitude, point.longitude], {
                    color: point.sectorColor,
                    fillColor: point.color,
                    fillOpacity: 1,
                    radius: 5
                }).addTo(allPointsLayer);
                pointMarker.on('click', function() {
                    $('#info-name').text(point.fname);
                    $('#info-BrandName').text(point.BrandName);
                    $('#info-AREA2').text(point.AREA2);
                    $('#info-FacilityStatus').text(point.FacilityStatus);
                    $('#info-sector').text(point.sector);
                    $('#info-area').text(point.area);
                    $('#info-subarea').text(point.subarea);
                    $('#info-subunit').text(point.subunit);
                    $('#info-lic').text(point.lic);
                    var d = new Date(point.Fdate);
                    var dd = ('0' + d.getDate()).slice(-2);
                    var mm = ('0' + (d.getMonth() + 1)).slice(-2);
                    var yyyy = d.getFullYear();
                    $('#info-Fdate').text(dd + '-' + mm + '-' + yyyy);
                    $('#info-action').text(point.action);
                    $('#info-coordinates').text(point.latitude + ', ' + point.longitude);
                });
                pointMarker.on('dblclick', function() {
                    window.open('https://www.google.com/maps?q=' + point.latitude + ',' + point.longitude, '_blank');
                });
            });
            updateTotals(points);
        }
        function filterPoints() {
            var selectedactions = [];
            $('.action-filter:checked').each(function() {
                selectedactions.push($(this).val());
            });
            var selectedSectors = [];
            $('.sector-filter:checked').each(function() {
                selectedSectors.push($(this).val());
            });
            var searchText = $('#search-lic').val().toLowerCase();
            var dateFrom = new Date($('#date-from').val());
            var dateTo = new Date($('#date-to').val());
            var isDateFilterActive = !isNaN(dateFrom.getTime()) && !isNaN(dateTo.getTime());
            var filteredPoints = pointsData.filter(function(point) {
                var actionMatch = selectedactions.length === 0 || selectedactions.includes(point.action);
                var sectorMatch = selectedSectors.length === 0 || selectedSectors.includes(String(point.sector));
                var formatDate = function(dateStr) {
                    var d = new Date(dateStr);
                    var day = ('0' + d.getDate()).slice(-2);
                    var month = ('0' + (d.getMonth() + 1)).slice(-2);
                    var year = d.getFullYear();
                    return day + '-' + month + '-' + year;
                };
                var searchMatch = searchText === '' || point.lic.toLowerCase().includes(searchText) || point.fname.toLowerCase().includes(searchText) || point.BrandName.toLowerCase().includes(searchText) || point.area.toLowerCase().includes(searchText) || point.FacilityStatus.toLowerCase().includes(searchText) || point.subunit.toLowerCase().includes(searchText) || point.subarea.toLowerCase().includes(searchText) || formatDate(point.Fdate).includes(searchText);
                var dateMatch = true;
                if (isDateFilterActive) {
                    var pointDate = new Date(point.Fdate);
                    dateMatch = pointDate >= dateFrom && pointDate <= dateTo;
                }
                return actionMatch && sectorMatch && searchMatch && dateMatch;
            });
            renderPoints(filteredPoints);
        }
        $('#search-lic').on('input', function() {
            filterPoints();
        });
        function updateTotals(points) {
            var totalsHtml = '<h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø·: ' + points.length + '</h4>';
            var sectorCounts = {};
            var actionCounts = {};
            points.forEach(function(point) {
                sectorCounts[point.sector] = (sectorCounts[point.sector] || 0) + 1;
                actionCounts[point.action] = (actionCounts[point.action] || 0) + 1;
            });
            totalsHtml += '<h5>Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª:</h5><ul>';
            totalsHtml += '<li>Ø§Ù„Ù‚Ø·Ø§Ø¹ 1: ' + (sectorCounts['1'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù‚Ø·Ø§Ø¹ 2: ' + (sectorCounts['2'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù‚Ø·Ø§Ø¹ 3: ' + (sectorCounts['3'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù‚Ø·Ø§Ø¹ 4: ' + (sectorCounts['4'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù‚Ø·Ø§Ø¹ 5: ' + (sectorCounts['5'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù‚Ø·Ø§Ø¹ 6: ' + (sectorCounts['6'] || 0) + '</li>';
            totalsHtml += '<li>Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØªØ³ÙˆÙ‚ ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ© 7: ' + (sectorCounts['7'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù…Ù†Ø´Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© 8: ' + (sectorCounts['8'] || 0) + '</li>';
            totalsHtml += '<li>Ø±Ø®ØµØ© Ø§Ø¹ØªÙ…Ø§Ø¯ 9: ' + (sectorCounts['9'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù…Ù‚Ø§ØµÙ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© 10: ' + (sectorCounts['10'] || 0) + '</li>';
            totalsHtml += '<li>Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ 11: ' + (sectorCounts['11'] || 0) + '</li>';
            totalsHtml += '</ul><h5>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª:</h5><ul>';
            totalsHtml += '<li>Ø§Ù†Ø°Ø§Ø±: ' + (actionCounts['Ø§Ù†Ø°Ø§Ø±'] || 0) + '</li>';
            totalsHtml += '<li>Ù…Ø®Ø§Ù„ÙØ©: ' + (actionCounts['Ù…Ø®Ø§Ù„ÙØ©'] || 0) + '</li>';
            totalsHtml += '<li>Ø¹ÙŠÙ†Ø§Øª: ' + (actionCounts['Ø¹ÙŠÙ†Ø§Øª'] || 0) + '</li>';
            totalsHtml += '<li>Ù…ØªØ§Ø¨Ø¹Ø©: ' + (actionCounts['Ù…ØªØ§Ø¨Ø¹Ø©'] || 0) + '</li>';
            totalsHtml += '<li>Ù…ØºÙ„Ù‚: ' + (actionCounts['Ù…ØºÙ„Ù‚'] || 0) + '</li>';
            totalsHtml += '<li>ØªÙ‚Ø±ÙŠØ±: ' + (actionCounts['ØªÙ‚Ø±ÙŠØ±'] || 0) + '</li>';
            totalsHtml += '<li>Ù…Ù†Ø§Ø³Ø¨: ' + (actionCounts['Ù…Ù†Ø§Ø³Ø¨'] || 0) + '</li>';
            totalsHtml += '</ul>';
            $('#totals').html(totalsHtml);
        }
        renderPoints(pointsData);
    </script>

<script>
// ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø¨
var alertAudio = new Audio('https://www.soundjay.com/button/beep-07.wav');

// Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission();
}

function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371e3;
    const Ï†1 = lat1 * Math.PI / 180;
    const Ï†2 = lat2 * Math.PI / 180;
    const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
    const Î”Î» = (lon2 - lon1) * Math.PI / 180;

    const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
              Math.cos(Ï†1) * Math.cos(Ï†2) *
              Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

    return R * c;
}

let notifiedPoints = [];

function checkProximity() {
    if (!navigator.geolocation) {
        console.log("Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­");
        return;
    }

    navigator.geolocation.getCurrentPosition(position => {
        const userLat = position.coords.latitude;
        const userLon = position.coords.longitude;

        pointsData.forEach(point => {
            if (point.action === 'Ø§Ù†Ø°Ø§Ø±') {
                const distance = getDistance(userLat, userLon, point.latitude, point.longitude);
                if (distance < 500 && !notifiedPoints.includes(point.lic)) {
                    const timeEst = Math.round((distance / 80) * 60);

                    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
                    alertAudio.play();

                    // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±
                    if ("Notification" in window && Notification.permission === "granted") {
                        new Notification("ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©", {
                            body: `ğŸŸ¡ Ø£Ù†Øª Ø¹Ù„Ù‰ Ø¨Ø¹Ø¯ ${timeEst} Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ù† ${point.fname}`,
                            icon: 'https://cdn-icons-png.flaticon.com/512/684/684908.png'
                        });
                    }

                    notifiedPoints.push(point.lic); // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                }
            }
        });
    });
}

setInterval(checkProximity, 30000);
</script>

</body>
</html>
