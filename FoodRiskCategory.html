<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ø³ØªÙ…Ø§Ø±Ø© ØªÙ‚ÙŠÙŠÙ… ÙØ¦Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© | Sharjah Food Risk Assessment</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Open+Sans:wght@400;700&display=swap');
    
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(to right, #e8f5e9, #c8e6c9);
      margin: 0;
      padding: 0;
      color: #1b5e20;
    }

    .page-top-custom-header {
        padding: 10px 15px;
        position: relative; 
        min-height: 60px; 
        border-bottom: 1px solid #e0e0e0;
        margin-bottom: 15px;
        background-color: #fdfdfd; 
    }
    .logo-and-text-container {
        position: absolute;
        left: 15px; 
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        align-items: center;
        direction: ltr; 
    }
    .custom-header-logo {
        height: 45px; 
        width: auto;
        margin-right: 8px; 
    }
    .custom-header-text {
        font-size: 9px; 
        line-height: 1.2;
        color: #333;
    }
    .custom-header-text p {
        margin: 0;
        text-align: left; 
    }
    
    .container {
      max-width: 1000px;
      margin: 10px auto;
      background: #fff;
      padding: 20px; 
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }
    
    h2.form-main-title {
      text-align: center;
      color: #1b5e20;
      margin-top: 0;
      margin-bottom: 15px; 
      position: relative;
      font-size: 20px; 
    }
    h2.form-main-title .english-main { display: none; }
    
    h2.form-main-title:after {
      content: "";
      display: block;
      width: 80px; 
      height: 2px; 
      background: #000000; /* Black color for underline */
      margin: 6px auto; 
    }
    
    label {
      display: block;
      margin: 6px 0 1px; 
      font-weight: bold;
      color: #1b5e20;
      font-size: 14px; 
    }
    
    .info .bilingual { margin-bottom: 0px; } 

    .info input, input[type="date"] {
      width: 100%;
      padding: 7px; 
      margin: 1px 0 8px; 
      border-radius: 4px;
      border: 1px solid #a5d6a7;
      font-family: 'Cairo', sans-serif;
      box-sizing: border-box;
      font-size: 13px; 
    }
    input[type="date"] { color-scheme: light; }
    
    .section {
      margin-bottom: 12px; 
      border-bottom: 1px dashed #a5d6a7;
      padding-bottom: 8px; 
    }
    .section:last-of-type { border-bottom: none; }
    
    .options label, .checkboxes label {
      display: flex;
      align-items: center;
      margin: 3px 0; 
      font-weight: normal;
      font-size: 13px; 
      justify-content: flex-start;
    }
    
    .options input[type="radio"], .checkboxes input[type="checkbox"], .checkboxes input[type="radio"] {
      margin-left: 0;
      margin-right: 7px; 
    }
    
    .result-box {
      margin-top: 15px; 
      padding: 12px; 
      background-color: #e8f5e9;
      border: 2px solid #2e7d32;
      border-radius: 6px;
      font-size: 16px; 
      font-weight: bold;
      color: #1b5e20;
      text-align: center;
    }
    .result-box .english { display: none; }
    
    .btn {
      display: inline-block;
      margin: 15px 4px 0; 
      padding: 9px 13px; 
      background-color: #2e7d32;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 18px; 
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s;
      line-height: 1;
    }
    
    .btn:hover {
      background-color: #1b5e20;
      transform: translateY(-1px); 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    @media print {
      body * { visibility: hidden; }
      .print-container, .print-container * { visibility: visible; }
      .print-container { position: absolute; left: 0; top: 0; width: 100%; padding: 20px; background: white; }
      .no-print, .page-top-custom-header { display: none; } 
    }
    
    .bilingual > .english, .options .english, .checkboxes .english { display: none !important; }
    .bilingual > .arabic { flex-basis: 100%; padding-left: 0; border-right: none; }
    .bilingual > label.arabic { width: 100%; text-align: right; }
    .options .arabic, .checkboxes .arabic { margin-right: 5px; }
    
    @media (max-width: 768px) {
      .container { padding: 15px; margin: 5px auto; }
      .page-top-custom-header {
        min-height: 55px; 
        padding: 5px 10px;
        margin-bottom:10px;
      }
      .logo-and-text-container {
        left: 10px; 
      }
      .custom-header-logo { height: 35px; margin-right: 6px;}
      .custom-header-text { font-size: 8px; line-height: 1.2;}
      
      h2.form-main-title { font-size: 18px; margin-bottom: 10px;}
      h2.form-main-title:after { width: 70px; height:2px; margin: 5px auto;}
      label { font-size: 13px; margin: 4px 0 1px;}
      .info input, input[type="date"] { font-size: 12px; padding:6px; margin-bottom:6px; }
      .options label, .checkboxes label { font-size: 12px; margin: 2px 0;}
      .result-box { font-size: 14px; padding: 10px;}
      .btn { font-size: 16px; padding: 7px 10px; margin-top: 10px;}
    }
  </style>
</head>
<body>
  <div class="page-top-custom-header">
    <div class="logo-and-text-container">
        <img src='https://zmohd1987.github.io/map1/ShjLogo.png' alt='Ø´Ø¹Ø§Ø± Ø¨Ù„Ø¯ÙŠØ© Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´Ø§Ø±Ù‚Ø©' class="custom-header-logo">
        <div class="custom-header-text">
            <p>Ø¨Ù„Ø¯ÙŠØ© Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´Ø§Ø±Ù‚Ø©</p>
            <p>Ù‚Ø³Ù… Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©</p>
        </div>
    </div>
  </div>

  <div class="container">
    <h2 class="form-main-title"><span class="arabic-main">Ø§Ø³ØªÙ…Ø§Ø±Ø© ØªÙ‚ÙŠÙŠÙ… ÙØ¦Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©</span><br><span class="english-main">Food Establishment Risk Assessment Form</span></h2>
    
    <div class="info">
      <div class="bilingual"><label class="arabic">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</label></div>
      <input type="text" id="facilityName">
      
      <div class="bilingual"><label class="arabic">Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©:</label></div>
      <input type="text" id="licenseNumber">
      
      <div class="bilingual"><label class="arabic">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label></div>
      <input type="text" id="address">
      
      <div class="bilingual"><label class="arabic">Ø§Ù„Ù†Ø´Ø§Ø·:</label></div>
      <input type="text" id="activity">
      
      <div class="bilingual"><label class="arabic">Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</label></div>
      <input type="text" id="responsiblePerson">
      
      <div class="bilingual"><label class="arabic">Ø§Ù„Ù‡Ø§ØªÙ:</label></div>
      <input type="text" id="phone">

      <div class="bilingual"><label class="arabic">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</label></div>
      <input type="date" id="assessmentDate">
    </div>

    <form id="riskForm">
      <div class="section">
        <div class="bilingual"> <label class="arabic">1) Ù†ÙˆØ¹ Ø§Ù„ØºØ°Ø§Ø¡ Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„ / Ø§Ù„Ù…Ø­Ø¶Ø± / Ø§Ù„Ù…ØµÙ†Ø¹</label> </div>
        <div class="options">
          <label><input type="radio" name="q1" value="20"> <span class="arabic">Ø£. Ø£ØºØ°ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø£ÙƒÙ„ (20)</span><span class="english">a. High-risk ready-to-eat foods (20)</span></label>
          <label><input type="radio" name="q1" value="10"> <span class="arabic">Ø¨. Ø£ØºØ°ÙŠØ© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© ØºÙŠØ± Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø£ÙƒÙ„ (10)</span><span class="english">b. Medium-risk non-ready-to-eat foods (10)</span></label>
          <label><input type="radio" name="q1" value="5"> <span class="arabic">Ø¬. Ø£ØºØ°ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (5)</span><span class="english">c. Low-risk foods (5)</span></label>
        </div>
      </div>
      <div class="section">
        <div class="bilingual"> <label class="arabic">2) Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ / Ø§Ù„ØªØ­Ø¶ÙŠØ± / Ø§Ù„ØªØµÙ†ÙŠØ¹</label> </div>
        <div class="options">
          <label><input type="radio" name="q2" value="30"> <span class="arabic">Ø£. ØªØ¯Ø§ÙˆÙ„/ ØªØ­Ø¶ÙŠØ± ÙƒØ¨ÙŠØ± Ù„Ø£ØºØ°ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (30)</span><span class="english">a. Extensive handling of high-risk foods (30)</span></label>
          <label><input type="radio" name="q2" value="25"> <span class="arabic">Ø¨. ØªØ¯Ø§ÙˆÙ„/ ØªØ­Ø¶ÙŠØ± Ù…Ø­Ø¯ÙˆØ¯ Ù„Ø£ØºØ°ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (25)</span><span class="english">b. Limited handling of high-risk foods (25)</span></label>
          <label><input type="radio" name="q2" value="20"> <span class="arabic">Ø¬. ØªØ¯Ø§ÙˆÙ„ Ù„Ø£ØºØ°ÙŠØ© Ù…ØªÙ†ÙˆØ¹Ø© Ø¹Ù†Ø¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ (20)</span><span class="english">c. Handling of various foods at point of sale (20)</span></label>
          <label><input type="radio" name="q2" value="15"> <span class="arabic">Ø¯. ØªØ¯Ø§ÙˆÙ„ Ù„Ø£ØºØ°ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© (15)</span><span class="english">d. Handling of low-risk foods (15)</span></label>
          <label><input type="radio" name="q2" value="10"> <span class="arabic">Ù‡Ù€. ØªØ®Ø²ÙŠÙ†/ ØªÙˆØ²ÙŠØ¹/ Ø¨ÙŠØ¹ Ù„Ø£ØºØ°ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ù…Ø¹Ø¨Ø£Ø© (10)</span><span class="english">e. Storage/distribution/sale of packaged low-risk foods (10)</span></label>
        </div>
      </div>
      <div class="section">
        <div class="bilingual"> <label class="arabic">3) Ø§Ù„ØªØ¬Ù‡ÙŠØ²Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚</label> </div>
        <div class="options">
          <label><input type="radio" name="q3" value="10"> <span class="arabic">Ø£. Ø§Ù„ØªØ¬Ù‡ÙŠØ²Ø§Øª ØºÙŠØ± Ù…Ù†Ø§Ø³Ø¨Ø© Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§Ø­Ø© ØºÙŠØ± ÙƒØ§ÙÙŠØ© (10)</span><span class="english">a. Inadequate equipment or insufficient space (10)</span></label>
          <label><input type="radio" name="q3" value="0"> <span class="arabic">Ø¨. Ø§Ù„ØªØ¬Ù‡ÙŠØ²Ø§Øª ÙˆØ§Ù„Ù…Ø±Ø§ÙÙ‚ Ù…Ù†Ø§Ø³Ø¨Ø© (0)</span><span class="english">b. Suitable equipment and facilities (0)</span></label>
        </div>
      </div>
      <div class="section">
        <div class="bilingual"> <label class="arabic">4) Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒÙŠÙ†</label> </div>
        <div class="options">
          <label><input type="radio" name="q4" value="10"> <span class="arabic">Ø£. ØªÙ‚Ø¯Ù… Ø£ÙƒØ«Ø± Ù…Ù† 500 ÙˆØ¬Ø¨Ø© ÙŠÙˆÙ…ÙŠØ§Ù‹ (10)</span><span class="english">a. Serves more than 500 meals daily (10)</span></label>
          <label><input type="radio" name="q4" value="5"> <span class="arabic">Ø¨. Ø¨ÙŠÙ† 100 Ø¥Ù„Ù‰ 500 ÙˆØ¬Ø¨Ø© (5)</span><span class="english">b. Between 100 to 500 meals (5)</span></label>
          <label><input type="radio" name="q4" value="0"> <span class="arabic">Ø¬. Ø£Ù‚Ù„ Ù…Ù† 100 ÙˆØ¬Ø¨Ø© (0)</span><span class="english">c. Less than 100 meals (0)</span></label>
        </div>
      </div>
      <div class="section">
        <div class="bilingual"> <label class="arabic">5) ÙØ¦Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒÙŠÙ†</label> </div>
        <div class="options">
          <label><input type="radio" name="q5" value="10"> <span class="arabic">Ø£. Ø§Ù„Ù…Ù†Ø´Ø£Ø© ØªØ®Ø¯Ù… ÙØ¦Ø§Øª Ø­Ø³Ø§Ø³Ø© (10)</span><span class="english">a. Establishment serves sensitive groups (10)</span></label>
          <label><input type="radio" name="q5" value="0"> <span class="arabic">Ø¨. Ù„Ø§ ØªØ®Ø¯Ù… ÙØ¦Ø§Øª Ø­Ø³Ø§Ø³Ø© (0)</span><span class="english">b. Does not serve sensitive groups (0)</span></label>
        </div>
      </div>
      <div class="section">
        <div class="bilingual"> <label class="arabic">6) Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</label> </div>
        <div class="options">
          <label><input type="radio" name="q6" value="20"> <span class="arabic">Ø£. ØºÙŠØ± Ù…Ù„ØªØ²Ù…Ø© (20)</span><span class="english">a. Non-compliant (20)</span></label>
          <label><input type="radio" name="q6" value="10"> <span class="arabic">Ø¨. ØªÙ„ØªØ²Ù… ØºØ§Ù„Ø¨Ø§Ù‹ ÙˆÙŠÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ø¨Ø³ÙŠØ·Ø© (10)</span><span class="english">b. Mostly compliant with minor violations (10)</span></label>
          <label><input type="radio" name="q6" value="0"> <span class="arabic">Ø¬. Ù…Ù„ØªØ²Ù…Ø© ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª (0)</span><span class="english">c. Fully compliant with no violations (0)</span></label>
        </div>
      </div>
      <div class="section">
        <div class="bilingual"> <label class="arabic">Ù†Ø¸Ø§Ù… Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£ØºØ°ÙŠØ© Ø§Ù„Ù…Ø·Ø¨Ù‚:</label> </div>
        <div class="checkboxes">
          <label><input type="checkbox" id="haccp" value="HACCP"> <span class="arabic">Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø§Ø³Ø¨</span><span class="english">HACCP System</span></label>
          <label><input type="checkbox" id="ghp" value="GHP"> <span class="arabic">Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„Ù†Ø¸Ø§ÙØ© Ø§Ù„Ø¬ÙŠØ¯Ø©</span><span class="english">Good Hygiene Practices (GHP)</span></label>
          <label><input type="radio" name="systemApplied" value="Ù†Ø¹Ù…" id="systemYes"> <span class="arabic">Ø§Ù„Ù…Ù†Ø´Ø£Ø© ØªØ·Ø¨Ù‚ Ù†Ø¸Ø§Ù… Ø³Ù„Ø§Ù…Ø©</span><span class="english">Establishment applies a safety system</span></label>
          <label><input type="radio" name="systemApplied" value="Ù„Ø§" id="systemNo"> <span class="arabic">Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ù„Ø§ ØªØ·Ø¨Ù‚ Ù†Ø¸Ø§Ù… Ø³Ù„Ø§Ù…Ø©</span><span class="english">Establishment does not apply a safety system</span></label>
        </div>
      </div>

      <div class="result-box" id="result">
        <div class="arabic">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0 | Ø§Ù„ÙØ¦Ø©: -</div>
        <div class="english">Total: 0 | Category: -</div>
      </div>
      
      <div style="text-align: center;">
        <button type="button" class="btn" onclick="printReport()" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±">ğŸ–¨ï¸</button>
        <button type="button" class="btn" onclick="sendWhatsApp()" title="Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨">ğŸ“±</button>
        <button type="button" class="btn" onclick="sendEmail()" title="Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">ğŸ“§</button>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const today = new Date();
        const assessmentDateField = document.getElementById('assessmentDate');
        if (assessmentDateField) {
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); 
            const day = String(today.getDate()).padStart(2, '0');
            assessmentDateField.value = `${year}-${month}-${day}`;
        }
        calculateRisk();
    });

    const form = document.getElementById('riskForm');
    const resultBox = document.getElementById('result');
    const assessmentDateFieldListener = document.getElementById('assessmentDate');

    if (form) form.addEventListener('change', calculateRisk);
    if (assessmentDateFieldListener) assessmentDateFieldListener.addEventListener('change', calculateRisk);

    function calculateRisk() {
      let total = 0;
      for (let i = 1; i <= 6; i++) {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (selected) { total += parseInt(selected.value); }
      }
      let categoryAr = '-'; let categoryEn = '-'; 
      if (total > 75) { categoryAr = 'Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹'; categoryEn = 'Very High'; }
      else if (total > 55) { categoryAr = 'Ø¹Ø§Ù„ÙŠØ©'; categoryEn = 'High'; }
      else if (total > 45) { categoryAr = 'Ù…ØªÙˆØ³Ø·Ø©'; categoryEn = 'Medium'; }
      else if (total > 25) { categoryAr = 'Ù…Ù†Ø®ÙØ¶Ø©'; categoryEn = 'Low'; }
      else if (total >= 0) { categoryAr = 'Ù…Ù†Ø®ÙØ¶Ø© Ø¬Ø¯Ø§Ù‹'; categoryEn = 'Very Low'; }
      resultBox.innerHTML = `<div class="arabic">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${total} | Ø§Ù„ÙØ¦Ø©: ${categoryAr}</div><div class="english">Total: ${total} | Category: ${categoryEn}</div>`;
    }

    function getSelectedRadioText(questionNumber) {
      const selected = document.querySelector(`input[name="q${questionNumber}"]:checked`);
      const parentLabel = selected ? selected.parentElement : null;
      const arabicSpan = parentLabel ? parentLabel.querySelector('.arabic') : null;
      const englishSpan = parentLabel ? parentLabel.querySelector('.english') : null;
      return { 
          arabic: arabicSpan ? arabicSpan.textContent.trim() : 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±',
          english: englishSpan ? englishSpan.textContent.trim() : 'Not selected'
      };
    }
    
    function getQuestionTitle(questionNumber) {
        const labelElement = document.querySelector(`#riskForm > .section:nth-of-type(${questionNumber}) .bilingual label.arabic`);
        return labelElement ? labelElement.textContent.trim() : `Ø§Ù„Ø³Ø¤Ø§Ù„ ${questionNumber}`;
    }

    function getSafetySystems() {
      let systemsAr = [], systemsEn = []; 
      const haccpCheckbox = document.getElementById('haccp');
      const ghpCheckbox = document.getElementById('ghp');

      if (haccpCheckbox.checked && haccpCheckbox.parentElement) {
        if(haccpCheckbox.parentElement.querySelector('.arabic')) systemsAr.push(haccpCheckbox.parentElement.querySelector('.arabic').textContent.trim());
        if(haccpCheckbox.parentElement.querySelector('.english')) systemsEn.push(haccpCheckbox.parentElement.querySelector('.english').textContent.trim());
      }
      if (ghpCheckbox.checked && ghpCheckbox.parentElement) {
         if(ghpCheckbox.parentElement.querySelector('.arabic')) systemsAr.push(ghpCheckbox.parentElement.querySelector('.arabic').textContent.trim());
         if(ghpCheckbox.parentElement.querySelector('.english')) systemsEn.push(ghpCheckbox.parentElement.querySelector('.english').textContent.trim());
      }
      const systemApplied = document.querySelector('input[name="systemApplied"]:checked');
      if (systemApplied && systemApplied.parentElement) {
        if(systemApplied.parentElement.querySelector('.arabic')) systemsAr.push(systemApplied.parentElement.querySelector('.arabic').textContent.trim());
        if(systemApplied.parentElement.querySelector('.english')) systemsEn.push(systemApplied.parentElement.querySelector('.english').textContent.trim());
      }
      return {
        arabic: systemsAr.length > 0 ? systemsAr.join('ØŒ ') : 'Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†Ø¸Ø§Ù… Ø³Ù„Ø§Ù…Ø© Ù…Ø·Ø¨Ù‚',
        english: systemsEn.length > 0 ? systemsEn.join(', ') : 'No safety system specified' 
      };
    }

    function generateReportText() { 
      const facilityName = document.getElementById('facilityName').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
      const licenseNumber = document.getElementById('licenseNumber').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
      const address = document.getElementById('address').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
      const activity = document.getElementById('activity').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
      const responsiblePerson = document.getElementById('responsiblePerson').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
      const phone = document.getElementById('phone').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„';
      let assessmentDateValue = document.getElementById('assessmentDate').value;
      let formattedAssessmentDateAr = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      let formattedAssessmentDateEn = 'Not specified'; 
      if (assessmentDateValue) {
          try {
            const dateParts = assessmentDateValue.split('-');
            const dateObj = new Date(Date.UTC(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2])));
            const options = { year: 'numeric', month: '2-digit', day: '2-digit', timeZone: 'Asia/Dubai' }; 
            formattedAssessmentDateAr = new Intl.DateTimeFormat('ar-AE-u-nu-latn', options).format(dateObj);
            formattedAssessmentDateEn = new Intl.DateTimeFormat('en-GB', options).format(dateObj);
          } catch(e){ console.error("Error formatting assessment date for HTML report:", e); }
      }
      
      const q_full = Array.from({length: 6}, (_, i) => getSelectedRadioText(i + 1));
      const qTitles = Array.from({length: 6}, (_, i) => getQuestionTitle(i + 1));
      const safetySystemsReport = getSafetySystems(); 

      let totalScore = "0", categoryAr = '-', categoryEn = '-';
      const resultArabicDiv = resultBox.querySelector('.arabic');
      if (resultArabicDiv) { const partsAr = resultArabicDiv.textContent.split('|'); if(partsAr.length === 2) {totalScore = partsAr[0].replace('Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:', '').trim(); categoryAr = partsAr[1].replace('Ø§Ù„ÙØ¦Ø©:', '').trim();} }
      const resultEnglishDiv = resultBox.querySelector('.english'); 
      if (resultEnglishDiv) { const partsEn = resultEnglishDiv.textContent.split('|'); if(partsEn.length === 2) {categoryEn = partsEn[1].replace('Category:', '').trim();} }

      const reportHTML = `
        <!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><title>ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… ÙØ¦Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© | Risk Assessment Report</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Open+Sans:wght@400;700&display=swap');
            body { font-family: 'Cairo', 'Open Sans', sans-serif; line-height: 1.6; padding: 20px; color: #1b5e20; background-color: #fafffa; }
            .report-header { text-align: center; margin-bottom: 20px; } .report-logo { height: 60px; margin-bottom: 8px; }
            .report-header-title { color: #1b5e20; margin: 0; font-size: 18px; font-family: 'Cairo', sans-serif; }
            .report-header-subtitle { color: #2e7d32; margin: 4px 0 12px; font-size: 14px; font-family: 'Cairo', sans-serif; }
            .report-main-title { text-align: center; color: #1b5e20; margin: 15px 0; font-size: 16px; font-family: 'Cairo', sans-serif; font-weight: bold; }
            table.report-table { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 11px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
            .report-table th, .report-table td { border: 1px solid #66bb6a; padding: 7px; vertical-align: top; }
            .report-table th { background-color: #a5d6a7; color: #145a32; font-weight: bold; font-family: 'Cairo', sans-serif; }
            .arabic-col { text-align: right; direction: rtl; font-family: 'Cairo', sans-serif; width: 45%; }
            .assessment-col { text-align: center; font-family: 'Cairo', sans-serif; width: 30%; font-weight: bold; color: #2e7d32; }
            .english-col { text-align: left; direction: ltr; font-family: 'Open Sans', sans-serif; width: 25%; }
            .section-title-row td { background-color: #c8e6c9 !important; color: #1b5e20; font-weight: bold; font-size: 13px; text-align: center;}
            .info-label { font-weight: bold; } .result-table { margin-top: 20px; width: 100%; }
            .result-table td { padding: 10px; font-size: 14px; font-weight: bold; }
            .result-label-ar { text-align: right; background-color: #e8f5e9; color: #1b5e20; }
            .result-value { text-align: center; background-color: #e8f5e9; color: #1b5e20; font-size:16px; } 
            .result-label-en { text-align: left; background-color: #e8f5e9; color: #1b5e20; }
            @media print { body { padding: 0; color: #000; background-color: #fff;} .no-print { display: none; } .report-table th, .report-table td { border: 1px solid #888; } .report-table th { background-color: #e0e0e0; color: #000;} .section-title-row td { background-color: #f0f0f0 !important; color: #000;} .result-table td { background-color: #f0f0f0; color: #000; } }
            .button-container { text-align: center; margin-top: 20px; } .print-btn, .close-btn { padding: 10px 20px; background: #2e7d32; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;}
            .print-btn:hover, .close-btn:hover { background: #1b5e20; }
        </style></head><body>
        <div class="report-header"><img src="https://zmohd1987.github.io/map1/ShjLogo.png" alt="Sharjah Municipality Logo" class="report-logo">
            <div class="report-header-title">Ø¨Ù„Ø¯ÙŠØ© Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´Ø§Ø±Ù‚Ø©</div><div class="report-header-subtitle">Ù‚Ø³Ù… Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©</div></div>
        <div class="report-main-title">ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… ÙØ¦Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©</div>
        <table class="report-table"><thead><tr><th class="arabic-col">Ø§Ù„Ø¨ÙŠØ§Ù† (Ø¹Ø±Ø¨ÙŠ)</th><th class="assessment-col">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… / Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</th><th class="english-col">Statement (English)</th></tr></thead><tbody>
            <tr class="section-title-row"><td colspan="3">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©</td></tr>
            <tr><td class="arabic-col"><span class="info-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</span> ${facilityName}</td><td class="assessment-col">${facilityName}</td><td class="english-col"><span class="info-label">Establishment Name:</span> ${facilityName}</td></tr>
            <tr><td class="arabic-col"><span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©:</span> ${licenseNumber}</td><td class="assessment-col">${licenseNumber}</td><td class="english-col"><span class="info-label">License Number:</span> ${licenseNumber}</td></tr>
            <tr><td class="arabic-col"><span class="info-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span> ${address}</td><td class="assessment-col">${address}</td><td class="english-col"><span class="info-label">Address:</span> ${address}</td></tr>
            <tr><td class="arabic-col"><span class="info-label">Ø§Ù„Ù†Ø´Ø§Ø·:</span> ${activity}</td><td class="assessment-col">${activity}</td><td class="english-col"><span class="info-label">Activity:</span> ${activity}</td></tr>
            <tr><td class="arabic-col"><span class="info-label">Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</span> ${responsiblePerson}</td><td class="assessment-col">${responsiblePerson}</td><td class="english-col"><span class="info-label">Responsible Person:</span> ${responsiblePerson}</td></tr>
            <tr><td class="arabic-col"><span class="info-label">Ø§Ù„Ù‡Ø§ØªÙ:</span> ${phone}</td><td class="assessment-col">${phone}</td><td class="english-col"><span class="info-label">Phone:</span> ${phone}</td></tr>
            <tr><td class="arabic-col"><span class="info-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span> ${formattedAssessmentDateAr}</td><td class="assessment-col">${formattedAssessmentDateAr}</td><td class="english-col"><span class="info-label">Assessment Date:</span> ${formattedAssessmentDateEn}</td></tr>
            <tr class="section-title-row"><td colspan="3">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</td></tr>
            ${q_full.map((ans, i) => `<tr><td class="arabic-col">${qTitles[i]}</td><td class="assessment-col">${ans.arabic}</td><td class="english-col">${ans.english}</td></tr>`).join('')}
            <tr class="section-title-row"><td colspan="3">Ù†Ø¸Ø§Ù… Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£ØºØ°ÙŠØ© Ø§Ù„Ù…Ø·Ø¨Ù‚</td></tr>
            <tr><td class="arabic-col">${safetySystemsReport.arabic}</td><td class="assessment-col">${safetySystemsReport.arabic}</td><td class="english-col">${safetySystemsReport.english}</td></tr>
        </tbody></table>
        <table class="report-table result-table"><tr class="section-title-row"><td colspan="3">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</td></tr>
            <tr><td class="result-label-ar">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${totalScore} | Ø§Ù„ÙØ¦Ø©: ${categoryAr}</td><td class="result-value">${totalScore}</td><td class="result-label-en">Total: ${totalScore} | Category: ${categoryEn}</td></tr>
        </table>
        <div class="no-print button-container"><button onclick="window.print()" class="print-btn">Ø·Ø¨Ø§Ø¹Ø©</button><button onclick="window.close()" class="close-btn">Ø¥ØºÙ„Ø§Ù‚</button></div>
        </body></html>`;
      return reportHTML;
    }

    function generateReportPlainText() {
        let report = `Ø¨Ù„Ø¯ÙŠØ© Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø´Ø§Ø±Ù‚Ø©\nÙ‚Ø³Ù… Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©\nØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… ÙØ¦Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©\n------------------------------------\n`;
        report += `Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø£Ø©:\n`;
        report += `Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©: ${document.getElementById('facilityName').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„'}\n`;
        report += `Ø±Ù‚Ù… Ø§Ù„Ø±Ø®ØµØ©: ${document.getElementById('licenseNumber').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„'}\n`;
        report += `Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${document.getElementById('address').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„'}\n`;
        report += `Ø§Ù„Ù†Ø´Ø§Ø·: ${document.getElementById('activity').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„'}\n`;
        report += `Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: ${document.getElementById('responsiblePerson').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„'}\n`;
        report += `Ø§Ù„Ù‡Ø§ØªÙ: ${document.getElementById('phone').value || 'ØºÙŠØ± Ù…Ø¯Ø®Ù„'}\n`;
        let assessmentDateValuePlain = document.getElementById('assessmentDate').value;
        let formattedAssessmentDateArPlain = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        if (assessmentDateValuePlain) {
             try { 
                const dateParts = assessmentDateValuePlain.split('-');
                const dateObj = new Date(Date.UTC(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2])));
                formattedAssessmentDateArPlain = new Intl.DateTimeFormat('ar-AE-u-nu-latn', { day: '2-digit', month: '2-digit', year: 'numeric', timeZone: 'Asia/Dubai' }).format(dateObj);
             } catch(e) {}
        }
        report += `ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚ÙŠÙŠÙ…: ${formattedAssessmentDateArPlain}\n------------------------------------\nÙ†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:\n`;
        for (let i = 1; i <= 6; i++) { 
            const questionData = getSelectedRadioText(i); 
            report += `${getQuestionTitle(i)}: ${questionData.arabic}\n`; 
        }
        report += `------------------------------------\nÙ†Ø¸Ø§Ù… Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø£ØºØ°ÙŠØ© Ø§Ù„Ù…Ø·Ø¨Ù‚:\n${getSafetySystems().arabic}\n------------------------------------\n`;
        const resultArabicDiv = resultBox.querySelector('.arabic');
        let totalScoreText = 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0', categoryArText = 'Ø§Ù„ÙØ¦Ø©: -';
        if (resultArabicDiv && resultArabicDiv.textContent.includes('Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:')) { const partsAr = resultArabicDiv.textContent.split('|'); totalScoreText = partsAr[0].trim(); categoryArText = partsAr[1].trim(); }
        report += `Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:\n${totalScoreText}\n${categoryArText}\n------------------------------------\n`;
        return report;
    }

    function printReport() {
      const reportHTML = generateReportText();
      const printWindow = window.open('', '_blank');
      printWindow.document.write(reportHTML);
      printWindow.document.close();
    }

    function sendWhatsApp() {
        const plainTextReport = generateReportPlainText();
        const encodedMessage = encodeURIComponent(plainTextReport);
        const whatsappURL = `https://wa.me/?text=${encodedMessage}`;
        window.open(whatsappURL, '_blank');
    }
function sendEmail() {
    const facilityName = document.getElementById('facilityName')?.value || "Ù…Ù†Ø´Ø£Ø© ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©";
    const plainTextReportForEmail = generateReportPlainText();
    const subject = `ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… ÙØ¦Ø© Ø§Ù„Ø®Ø·ÙˆØ±Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© - ${facilityName}`;
    const body = plainTextReportForEmail;
    const mailtoURL = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

    // ÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø«Ø¨Øª (Ù…Ø«Ù„ Ø£ÙˆØªÙ„ÙˆÙƒ)
    const newWindow = window.open(mailtoURL, '_blank');

    if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {
        window.location.href = mailtoURL;
    }
}
  </script>
</body>
</html>